import{getUserData as e}from"@decentraland/Identity";import{getCurrentRealm as t}from"@decentraland/EnvironmentAPI";(function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:0,exports:{}};e[r].call(i.exports,i,i.exports,n);i.l=1;return i.exports}n.m=e;n.c=t;n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:1,get:r})};n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:1})};n.t=function(e,t){1&t&&(e=n(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:1,value:e});if(2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=49)})([,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(t,"__esModule",{value:1});t.ArraySchema=void 0;var o=function(e){r(t,e);function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.apply(this,n)||this;Object.setPrototypeOf(o,Object.create(t.prototype));Object.defineProperties(o,{$sorting:{value:void 0,enumerable:0,writable:1},$changes:{value:void 0,enumerable:0,writable:1},onAdd:{value:void 0,enumerable:0,writable:1},onRemove:{value:void 0,enumerable:0,writable:1},onChange:{value:void 0,enumerable:0,writable:1},triggerAll:{value:function(){if(o.onAdd)for(var e=0;e<o.length;e++)o.onAdd(o[e],e)}},toJSON:{value:function(){for(var e=[],t=0;t<o.length;t++){var n=o[t];e.push("function"==typeof n.toJSON?n.toJSON():n)}return e}},clone:{value:function(e){var n;if(e){(n=t.of.apply(t,o)).onAdd=o.onAdd;n.onRemove=o.onRemove;n.onChange=o.onChange}else n=new(t.bind.apply(t,i([void 0],o.map((function(e){return"object"==typeof e?e.clone():e})))));return n}}});return o}Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:0,configurable:1});t.prototype.sort=function(t){this.$sorting=1;e.prototype.sort.call(this,t);if(this.$changes)for(var n,r=0,i=Array.from(this.$changes.changes);r<i.length;r++){var o=i[r],s=this.$changes.getIndex(this[o]);void 0!==s&&this.$changes.mapIndexChange(this[o],s);this.$changes.mapIndex(this[o],o)}this.$sorting=0;return this};t.prototype.filter=function(t,n){var r=e.prototype.filter.call(this,t);r.$changes=this.$changes.clone();return r};t.prototype.splice=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Array.prototype.splice.apply(this,arguments),o=Array.prototype.filter.call(this,(function(n,r){return r>=e+t-1}));i.map((function(e){var t=e&&e.$changes;if(t&&t.parent){t.parent.deleteIndex(e);delete t.parent}}));o.forEach((function(e){var t=e&&e.$changes;t&&t.parentField--}));return i};return t}(Array);t.ArraySchema=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.MapSchema=void 0;var r=function(){function e(t){var n=this;void 0===t&&(t={});for(var r in t)this[r]=t[r];Object.defineProperties(this,{$changes:{value:void 0,enumerable:0,writable:1},onAdd:{value:void 0,enumerable:0,writable:1},onRemove:{value:void 0,enumerable:0,writable:1},onChange:{value:void 0,enumerable:0,writable:1},clone:{value:function(t){var r;if(t){(r=Object.assign(new e,n)).onAdd=n.onAdd;r.onRemove=n.onRemove;r.onChange=n.onChange}else{var i=new e;for(var o in n)"object"==typeof n[o]?i[o]=n[o].clone():i[o]=n[o]}return r}},triggerAll:{value:function(){if(n.onAdd)for(var e in n)n.onAdd(n[e],e)}},toJSON:{value:function(){var e={};for(var t in n)e[t]="function"==typeof n[t].toJSON?n[t].toJSON():n[t];return e}},_indexes:{value:new Map,enumerable:0,writable:1},_updateIndexes:{value:function(e){for(var t=0,r=new Map,i=0,o=e;i<o.length;i++){var s=o[i];r.set(s,t++)}n._indexes=r}}})}return e}();t.MapSchema=r},,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:1});t.Schema=void 0;var i=n(44),o=n(42),s=n(43),a=n(10),u=n(11),c=n(47),f=n(94),h=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);function l(e,t,n,r){var i,o=0;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number";isNaN(e)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+r);break;case"string":i="string";o=1;break;case"boolean":return}if(typeof e!==i&&(!o||o&&null!==e)){var s="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")");throw new h("a '"+i+"' was expected, but "+s+" was provided in "+n.constructor.name+"#"+r)}}function p(e,t,n,r){if(!(e instanceof t))throw new h("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+r)}function d(e,t,n,r,i){l(n,e,r,i);var s=o[e];if(!s)throw new h("a '"+e+"' was expected, but "+n+" was provided in "+r.constructor.name+"#"+i);s(t,n)}function v(e,t,n){return s[e](t,n)}var y=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new c.ChangeTree(this._indexes),enumerable:0,writable:1},$listeners:{value:{},enumerable:0,writable:1}});var n=this._descriptors;n&&Object.defineProperties(this,n)}e.onError=function(e){console.error(e)};Object.defineProperty(e.prototype,"_schema",{get:function(){return this.constructor._schema},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"_descriptors",{get:function(){return this.constructor._descriptors},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"_indexes",{get:function(){return this.constructor._indexes},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"_fieldsByIndex",{get:function(){return this.constructor._fieldsByIndex},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"_filters",{get:function(){return this.constructor._filters},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"_deprecated",{get:function(){return this.constructor._deprecated},enumerable:0,configurable:1});Object.defineProperty(e.prototype,"$changed",{get:function(){return this.$changes.changed},enumerable:0,configurable:1});e.prototype.listen=function(e,t){var n=this;this.$listeners[e]||(this.$listeners[e]=new f.EventEmitter);this.$listeners[e].register(t);return function(){return n.$listeners[e].remove(t)}};e.prototype.decode=function(t,n){void 0===n&&(n={offset:0});var r=[],o=this._schema,c=this._fieldsByIndex,f=t.length;t[n.offset]===i.TYPE_ID&&(n.offset+=2);for(var h=function(){var f=s.nilCheck(t,n)&&++n.offset,h=t[n.offset++];if(h===i.END_OF_STRUCTURE)return"break";var p=c[h],d="_"+p,y=o[p],g=void 0,_=0;if(!p)return"continue";if(f){g=null;_=1}else if(y._schema){(g=l[d]||l.createTypeInstance(t,n,y)).decode(t,n);_=1}else if(Array.isArray(y)){y=y[0];var b=l[d]||new a.ArraySchema;g=b.clone(1);var m=s.number(t,n),w=Math.min(s.number(t,n),m),O=g.length>m;_=w>0||O;var A=0;O&&Array.prototype.splice.call(g,m).forEach((function(t,n){if(t&&t.onRemove)try{t.onRemove()}catch(t){e.onError(t)}if(b.onRemove)try{b.onRemove(t,m+n)}catch(t){e.onError(t)}}));for(var C=0;C<w;C++){var S=s.number(t,n),E=void 0;if(s.indexChangeCheck(t,n)){s.uint8(t,n);E=s.number(t,n);A=1}var I=!A&&void 0===g[S]||A&&void 0===E;if(y.prototype instanceof e){var M=void 0;if(!(M=I?l.createTypeInstance(t,n,y):void 0!==E?b[E]:b[S])){M=l.createTypeInstance(t,n,y);I=1}M.decode(t,n);g[S]=M}else g[S]=v(y,t,n);if(I){if(b.onAdd)try{b.onAdd(g[S],S)}catch(t){e.onError(t)}}else if(b.onChange)try{b.onChange(g[S],S)}catch(t){e.onError(t)}}}else if(y.map){y=y.map;var P=l[d]||new u.MapSchema;g=P.clone(1);var k=s.number(t,n);_=k>0;for(var A=0,x=Object.keys(P),C=0;C<k&&(void 0!==t[n.offset]&&t[n.offset]!==i.END_OF_STRUCTURE);C++){var j=s.nilCheck(t,n)&&++n.offset,R=void 0;if(s.indexChangeCheck(t,n)){s.uint8(t,n);R=x[s.number(t,n)];A=1}var T=s.numberCheck(t,n),N="string"!=typeof y,$=T?x[s.number(t,n)]:s.string(t,n),M=void 0,I;M=(I=!A&&void 0===P[$]||A&&void 0===R&&T)&&N?l.createTypeInstance(t,n,y):void 0!==R?P[R]:P[$];if(j){if(M&&M.onRemove)try{M.onRemove()}catch(t){e.onError(t)}if(P.onRemove)try{P.onRemove(M,$)}catch(t){e.onError(t)}delete g[$]}else{if(N){M.decode(t,n);g[$]=M}else g[$]=v(y,t,n);if(I){if(P.onAdd)try{P.onAdd(g[$],$)}catch(t){e.onError(t)}}else if(P.onChange)try{P.onChange(g[$],$)}catch(t){e.onError(t)}}}}else _=(g=v(y,t,n))!==l[d];_&&(l.onChange||l.$listeners[p])&&r.push({field:p,value:g,previousValue:l[d]});l[d]=g},l=this;n.offset<f;){var p;if("break"===h())break}this._triggerChanges(r);return this};e.prototype.encode=function(e,t,n,r){var s=this;void 0===e&&(e=this);void 0===t&&(t=0);void 0===r&&(r=[]);if(!this.$changes.changed&&!t){this._encodeEndOfStructure(this,e,r);return r}for(var c=this._schema,f=this._indexes,h=this._fieldsByIndex,l=this._filters,v=Array.from(t?this.$changes.allChanges:this.$changes.changes).sort(),y=function(y,_){var b=h[v[y]]||v[y],m="_"+b,w=c[b],O=l&&l[b],A=g[m],C=f[b];if(void 0===A){o.uint8(r,i.NIL);o.number(r,C)}else if(w._schema){if(n&&O&&!O.call(g,n,A,e))return"continue";if(A){o.number(r,C);p(A,w,g,b);g.tryEncodeTypeId(r,w,A.constructor);A.encode(e,t,n,r)}else{o.uint8(r,i.NIL);o.number(r,C)}}else if(Array.isArray(w)){var S=A.$changes;if(n&&O&&!O.call(g,n,A,e))return"continue";o.number(r,C);o.number(r,A.length);var E=Array.from(t?S.allChanges:S.changes).filter((function(e){return void 0!==s[m][e]})).sort((function(e,t){return e-t})),I=E.length;o.number(r,I);var M="string"!=typeof w[0];p(g[m],a.ArraySchema,g,b);for(var P=0;P<I;P++){var k=E[P],x=g[m][k];if(M){o.number(r,k);if(!t){var j;if(void 0!==(j=S.getIndexChange(x))){o.uint8(r,i.INDEX_CHANGE);o.number(r,j)}}p(x,w[0],g,b);g.tryEncodeTypeId(r,w[0],x.constructor);x.encode(e,t,n,r)}else if(void 0!==x){o.number(r,k);d(w[0],r,x,g,b)}}t||n||S.discard()}else if(w.map){var S=A.$changes;if(n&&O&&!O.call(g,n,A,e))return"continue";o.number(r,C);var R=Array.from(t?S.allChanges:S.changes);o.number(r,R.length);var T=Array.from(S.allChanges),M="string"!=typeof w.map,I=R.length;p(g[m],u.MapSchema,g,b);for(var N=0;N<I;N++){var $=R[N],x=g[m][$],U=void 0;if(t){if(void 0===x)continue}else{var j=S.getIndexChange(x);if(x&&void 0!==j){o.uint8(r,i.INDEX_CHANGE);o.number(r,g[m]._indexes.get(j))}U=S.isDeleted($)&&x?void 0:g[m]._indexes.get($)}var z=void 0===x;z&&o.uint8(r,i.NIL);void 0!==U?o.number(r,U):o.string(r,$);if(x&&M){p(x,w.map,g,b);g.tryEncodeTypeId(r,w.map,x.constructor);x.encode(e,t,n,r)}else z||d(w.map,r,x,g,b)}if(!t&&!n){S.discard();g[m]._updateIndexes(T)}}else{if(n&&O&&!O.call(g,n,A,e))return"continue";o.number(r,C);d(w,r,A,g,b)}},g=this,_=0,b=v.length;_<b;_++)y(_,b);this._encodeEndOfStructure(this,e,r);t||n||this.$changes.discard();return r};e.prototype.encodeFiltered=function(e,t){return this.encode(this,0,e,t)};e.prototype.encodeAll=function(e){return this.encode(this,1,void 0,e)};e.prototype.encodeAllFiltered=function(e,t){return this.encode(this,1,e,t)};e.prototype.clone=function(){var e=new this.constructor,t=this._schema;for(var n in t)"object"==typeof this[n]&&"function"==typeof this[n].clone?e[n]=this[n].clone():e[n]=this[n];return e};e.prototype.triggerAll=function(){var t=[],n=this._schema;for(var r in n)void 0!==this[r]&&t.push({field:r,value:this[r],previousValue:void 0});try{this._triggerChanges(t)}catch(t){e.onError(t)}};e.prototype.toJSON=function(){var e=this._schema,t=this._deprecated,n={};for(var r in e)t[r]||null===this[r]||"undefined"==typeof this[r]||(n[r]="function"==typeof this[r].toJSON?this[r].toJSON():this["_"+r]);return n};e.prototype.discardAllChanges=function(){var t=this._schema,n=Array.from(this.$changes.changes),r=this._fieldsByIndex;for(var i in n){var o=r[i],s=t[o],a=this[o];if(void 0!==a)if(s._schema)a.discardAllChanges();else if(Array.isArray(s)){for(var u=0,c=a.length;u<c;u++){var f=a[u],h=this["_"+o][f];"string"!=typeof s[0]&&h&&h.discardAllChanges()}a.$changes.discard()}else if(s.map){for(var l=a,p=Object.keys(this["_"+o]),u=0;u<l.length;u++){var d=p[l[u]]||l[u],h;(h=this["_"+o][d])instanceof e&&h&&h.discardAllChanges()}a.$changes.discard()}}this.$changes.discard()};e.prototype._encodeEndOfStructure=function(e,t,n){e!==t&&n.push(i.END_OF_STRUCTURE)};e.prototype.tryEncodeTypeId=function(e,t,n){if(t._typeid!==n._typeid){o.uint8(e,i.TYPE_ID);o.uint8(e,n._typeid)}};e.prototype.createTypeInstance=function(e,t,n){if(e[t.offset]===i.TYPE_ID){t.offset++;var r;return new(this.constructor._context.get(s.uint8(e,t)))}return new n};e.prototype._triggerChanges=function(t){if(t.length>0){for(var n=0;n<t.length;n++){var r=t[n],i=this.$listeners[r.field];if(i)try{i.invoke(r.value,r.previousValue)}catch(t){e.onError(t)}}if(this.onChange)try{this.onChange(t)}catch(t){e.onError(t)}}};return e}();t.Schema=y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.HTTP_HOST=t.WS_HOST=void 0;t.WS_HOST="ws://localhost:2567";t.HTTP_HOST="http://localhost:2567"},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){n.r(t);n.d(t,"send",(function(){return i}));n.d(t,"get",(function(){return o}));n.d(t,"post",(function(){return s}));n.d(t,"patch",(function(){return a}));n.d(t,"del",(function(){return u}));n.d(t,"put",(function(){return c}));function r(e,t){t.headers=e.headers||{};t.statusMessage=e.statusText;t.statusCode=e.status;t.data=e.response}function i(e,t,n){return new Promise((function(i,o){n=n||{};var s,a,u,c,f=new XMLHttpRequest,h=n.headers||{};n.timeout&&(f.timeout=n.timeout);f.ontimeout=f.onerror=function(e){e.timeout="timeout"==e.type;o(e)};f.open(e,t.href||t);f.onload=function(){c=f.getAllResponseHeaders().trim().split(/[\r\n]+/);r(f,f);for(;u=c.shift();){u=u.split(": ");f.headers[u.shift().toLowerCase()]=u.join(": ")}if((u=f.headers["content-type"])&&~u.indexOf("application/json"))try{f.data=JSON.parse(f.data,n.reviver)}catch(e){r(f,e);return o(e)}(f.status>=400?o:i)(f)};if((a=n.body)&&"object"==typeof a){h["content-type"]="application/json";a=JSON.stringify(a)}f.withCredentials=!!n.withCredentials;for(s in h)f.setRequestHeader(s,h[s]);f.send(a)}))}var o=i.bind(i,"GET"),s=i.bind(i,"POST"),a=i.bind(i,"PATCH"),u=i.bind(i,"DELETE"),c=i.bind(i,"PUT")},function(e,t,n){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:1});var i=r(n(39)),o=n(80),s=n(81),a=n(82),u=n(40),c=n(41),f=r(n(42)),h=r(n(43)),l=function(){function e(e,t){var n=this;this.onJoin=o.createSignal();this.onStateChange=o.createSignal();this.onError=o.createSignal();this.onLeave=o.createSignal();this.hasJoined=0;this.onMessageHandlers=s.createNanoEvents();this.id=null;this.name=e;if(t){this.serializer=new(u.getSerializer("schema"));this.rootSchema=t;this.serializer.state=new t}else this.serializer=new(u.getSerializer("fossil-delta"));this.onError((function(e,t){return console.error("colyseus.js - onError => ("+e+") "+t)}));this.onLeave((function(){return n.removeAllListeners()}))}e.prototype.connect=function(e){var t=this;this.connection=new a.Connection(e,0);this.connection.reconnectEnabled=0;this.connection.onmessage=this.onMessageCallback.bind(this);this.connection.onclose=function(e){if(t.hasJoined)t.onLeave.invoke(e.code);else{console.error("Room connection was closed unexpectedly ("+e.code+"): "+e.reason);t.onError.invoke(e.code,e.reason)}};this.connection.onerror=function(e){console.warn("Room, onError ("+e.code+"): "+e.reason);t.onError.invoke(e.code,e.reason)};this.connection.open()};e.prototype.leave=function(e){void 0===e&&(e=1);this.connection?e?this.connection.send([c.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)};e.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)};e.prototype.send=function(e,t){var n=[c.Protocol.ROOM_DATA],r;"string"==typeof e?f.string(n,e):f.number(n,e);if(void 0!==t){var o=i.encode(t);(r=new Uint8Array(n.length+o.byteLength)).set(new Uint8Array(n),0);r.set(new Uint8Array(o),n.length)}else r=new Uint8Array(n);this.connection.send(r.buffer)};Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:1,configurable:1});e.prototype.listen=function(e,t,n){if("schema"!==this.serializerId){this.serializerId||console.warn("room.Listen() should be called after room.onJoin has been called (DEPRECATION WARNING)");return this.serializer.api.listen(e,t,n)}console.error("'"+this.serializerId+"' serializer doesn't support .listen() method here.")};e.prototype.removeListener=function(e){return this.serializer.api.removeListener(e)};e.prototype.removeAllListeners=function(){this.serializer&&this.serializer.teardown();this.onJoin.clear();this.onStateChange.clear();this.onError.clear();this.onLeave.clear()};e.prototype.onMessageCallback=function(e){var t=Array.from(new Uint8Array(e.data)),n=t[0];if(n===c.Protocol.JOIN_ROOM){var r=1;this.serializerId=c.utf8Read(t,r);r+=c.utf8Length(this.serializerId);var o=u.getSerializer(this.serializerId);if(!o)throw new Error("missing serializer: "+this.serializerId);"fossil-delta"===this.serializerId||this.rootSchema||(this.serializer=new o);t.length>r&&this.serializer.handshake&&this.serializer.handshake(t,{offset:1});this.hasJoined=1;this.onJoin.invoke();this.connection.send([c.Protocol.JOIN_ROOM])}else if(n===c.Protocol.ERROR){var s={offset:1},a=h.number(t,s),f=h.string(t,s);this.onError.invoke(a,f)}else if(n===c.Protocol.LEAVE_ROOM)this.leave();else if(n===c.Protocol.ROOM_DATA_SCHEMA){var l,p,f;(f=new(p=this.serializer.getState().constructor._context.get(t[1]))).decode(t,{offset:2});this.dispatchMessage(p,f)}else if(n===c.Protocol.ROOM_STATE){t.shift();this.setState(t)}else if(n===c.Protocol.ROOM_STATE_PATCH){t.shift();this.patch(t)}else if(n===c.Protocol.ROOM_DATA){var d={offset:1},p=h.stringCheck(t,d)?h.string(t,d):h.number(t,d),f=t.length>d.offset?i.decode(e.data,d.offset):void 0;this.dispatchMessage(p,f)}};e.prototype.setState=function(e){this.serializer.setState(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.patch=function(e){this.serializer.patch(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("onMessage not registered for type '"+e+"'.")};e.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}};return e}();t.Room=l},function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});var i=r(n(78)),o=r(n(79));t.decode=i.default;t.encode=o.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r={};function i(e,t){r[e]=t}t.registerSerializer=i;function o(e){return r[e]}t.getSerializer=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r,i;(function(e){e[e["HANDSHAKE"]=9]="HANDSHAKE";e[e["JOIN_ROOM"]=10]="JOIN_ROOM";e[e["ERROR"]=11]="ERROR";e[e["LEAVE_ROOM"]=12]="LEAVE_ROOM";e[e["ROOM_DATA"]=13]="ROOM_DATA";e[e["ROOM_STATE"]=14]="ROOM_STATE";e[e["ROOM_STATE_PATCH"]=15]="ROOM_STATE_PATCH";e[e["ROOM_DATA_SCHEMA"]=16]="ROOM_DATA_SCHEMA"})(r=t.Protocol||(t.Protocol={}));(function(e){e[e["MATCHMAKE_NO_HANDLER"]=4210]="MATCHMAKE_NO_HANDLER";e[e["MATCHMAKE_INVALID_CRITERIA"]=4211]="MATCHMAKE_INVALID_CRITERIA";e[e["MATCHMAKE_INVALID_ROOM_ID"]=4212]="MATCHMAKE_INVALID_ROOM_ID";e[e["MATCHMAKE_UNHANDLED"]=4213]="MATCHMAKE_UNHANDLED";e[e["MATCHMAKE_EXPIRED"]=4214]="MATCHMAKE_EXPIRED";e[e["AUTH_FAILED"]=4215]="AUTH_FAILED";e[e["APPLICATION_ERROR"]=4216]="APPLICATION_ERROR"})(i=t.ErrorCode||(t.ErrorCode={}));function o(e,t){for(var n=e[t++],r="",i=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((i=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){i-=65536;r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))}else r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++o]);else r+=String.fromCharCode(a)}return r}t.utf8Read=o;function s(e){void 0===e&&(e="");for(var t=0,n=0,r=0,i=e.length;r<i;r++)if((t=e.charCodeAt(r))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{r++;n+=4}return n+1}t.utf8Length=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.number=t.string=t.boolean=t.writeFloat64=t.writeFloat32=t.float64=t.float32=t.uint64=t.int64=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=t.utf8Write=void 0;function r(e){for(var t=0,n=0,r=0,i=e.length;r<i;r++)if((t=e.charCodeAt(r))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{r++;n+=4}return n}function i(e,t,n){for(var r=0,i=0,o=n.length;i<o;i++)if((r=n.charCodeAt(i))<128)e[t++]=r;else if(r<2048){e[t++]=192|r>>6;e[t++]=128|63&r}else if(r<55296||r>=57344){e[t++]=224|r>>12;e[t++]=128|r>>6&63;e[t++]=128|63&r}else{i++;r=65536+((1023&r)<<10|1023&n.charCodeAt(i));e[t++]=240|r>>18;e[t++]=128|r>>12&63;e[t++]=128|r>>6&63;e[t++]=128|63&r}}t.utf8Write=i;function o(e,t){e.push(255&t)}t.int8=o;function s(e,t){e.push(255&t)}t.uint8=s;function a(e,t){e.push(255&t);e.push(t>>8&255)}t.int16=a;function u(e,t){e.push(255&t);e.push(t>>8&255)}t.uint16=u;function c(e,t){e.push(255&t);e.push(t>>8&255);e.push(t>>16&255);e.push(t>>24&255)}t.int32=c;function f(e,t){var n=t>>24,r=t>>16,i=t>>8,o=t;e.push(255&o);e.push(255&i);e.push(255&r);e.push(255&n)}t.uint32=f;function h(e,t){var n=Math.floor(t/Math.pow(2,32)),r;f(e,t>>>0);f(e,n)}t.int64=h;function l(e,t){var n=t/Math.pow(2,32)>>0,r;f(e,t>>>0);f(e,n)}t.uint64=l;function p(e,t){b(e,t)}t.float32=p;function d(e,t){m(e,t)}t.float64=d;var v=1,y=new Int32Array(2),g=new Float32Array(y.buffer),_=new Float64Array(y.buffer);function b(e,t){g[0]=t;c(e,y[0])}t.writeFloat32=b;function m(e,t){_[0]=t;c(e,y[v?0:1]);c(e,y[v?1:0])}t.writeFloat64=m;function w(e,t){return s(e,t?1:0)}t.boolean=w;function O(e,t){t||(t="");var n=r(t),o=0;if(n<32){e.push(160|n);o=1}else if(n<256){e.push(217);s(e,n);o=2}else if(n<65536){e.push(218);u(e,n);o=3}else{if(!(n<4294967296))throw new Error("String too long");e.push(219);f(e,n);o=5}i(e,e.length,t);return o+n}t.string=O;function A(e,t){if(isNaN(t))return A(e,0);if(!isFinite(t))return A(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);if(t!==(0|t)){e.push(203);m(e,t);return 9}if(t>=0){if(t<128){s(e,t);return 1}if(t<256){e.push(204);s(e,t);return 2}if(t<65536){e.push(205);u(e,t);return 3}if(t<4294967296){e.push(206);f(e,t);return 5}e.push(207);l(e,t);return 9}if(t>=-32){e.push(t);return 1}if(t>=-128){e.push(208);o(e,t);return 2}if(t>=-32768){e.push(209);a(e,t);return 3}if(t>=-2147483648){e.push(210);c(e,t);return 5}e.push(211);h(e,t);return 9}t.number=A},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.indexChangeCheck=t.nilCheck=t.arrayCheck=t.numberCheck=t.number=t.stringCheck=t.string=t.boolean=t.readFloat64=t.readFloat32=t.uint64=t.int64=t.float64=t.float32=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=void 0;var r=n(44);function i(e,t,n){for(var r="",i=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((i=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){i-=65536;r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))}else r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++o]);else r+=String.fromCharCode(a)}return r}function o(e,t){return s(e,t)<<24>>24}t.int8=o;function s(e,t){return e[t.offset++]}t.uint8=s;function a(e,t){return u(e,t)<<16>>16}t.int16=a;function u(e,t){return e[t.offset++]|e[t.offset++]<<8}t.uint16=u;function c(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}t.int32=c;function f(e,t){return c(e,t)>>>0}t.uint32=f;function h(e,t){return b(e,t)}t.float32=h;function l(e,t){return m(e,t)}t.float64=l;function p(e,t){var n=f(e,t),r;return c(e,t)*Math.pow(2,32)+n}t.int64=p;function d(e,t){var n=f(e,t),r;return f(e,t)*Math.pow(2,32)+n}t.uint64=d;var v=1,y=new Int32Array(2),g=new Float32Array(y.buffer),_=new Float64Array(y.buffer);function b(e,t){y[0]=c(e,t);return g[0]}t.readFloat32=b;function m(e,t){y[v?0:1]=c(e,t);y[v?1:0]=c(e,t);return _[0]}t.readFloat64=m;function w(e,t){return s(e,t)>0}t.boolean=w;function O(e,t){var n=e[t.offset++],r;n<192?r=31&n:217===n?r=s(e,t):218===n?r=u(e,t):219===n&&(r=f(e,t));var o=i(e,t.offset,r);t.offset+=r;return o}t.string=O;function A(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}t.stringCheck=A;function C(e,t){var n=e[t.offset++];return n<128?n:202===n?b(e,t):203===n?m(e,t):204===n?s(e,t):205===n?u(e,t):206===n?f(e,t):207===n?d(e,t):208===n?o(e,t):209===n?a(e,t):210===n?c(e,t):211===n?p(e,t):n>223?-1*(255-n+1):void 0}t.number=C;function S(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}t.numberCheck=S;function E(e,t){return e[t.offset]<160}t.arrayCheck=E;function I(e,t){return e[t.offset]===r.NIL}t.nilCheck=I;function M(e,t){return e[t.offset]===r.INDEX_CHANGE}t.indexChangeCheck=M},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.TYPE_ID=t.INDEX_CHANGE=t.NIL=t.END_OF_STRUCTURE=void 0;t.END_OF_STRUCTURE=193;t.NIL=192;t.INDEX_CHANGE=212;t.TYPE_ID=213},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=2&s[0]?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;(i=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];i=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:1});var s=o(n(37)),a=n(86),u="colyseus-auth-token",c;(function(e){e["ios"]="ios";e["android"]="android"})(c=t.Platform||(t.Platform={}));var f=function(){function e(e){var t=this;this._id=void 0;this.username=void 0;this.displayName=void 0;this.avatarUrl=void 0;this.isAnonymous=void 0;this.email=void 0;this.lang=void 0;this.location=void 0;this.timezone=void 0;this.metadata=void 0;this.devices=void 0;this.facebookId=void 0;this.twitterId=void 0;this.googleId=void 0;this.gameCenterId=void 0;this.steamId=void 0;this.friendIds=void 0;this.blockedUserIds=void 0;this.createdAt=void 0;this.updatedAt=void 0;this.token=void 0;this.endpoint=e.replace("ws","http");a.getItem(u,(function(e){return t.token=e}))}Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:1,configurable:1});e.prototype.login=function(e){void 0===e&&(e={});return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:t=Object.assign({},e);this.hasToken&&(t.token=this.token);return[4,this.request("post","/auth",t)];case 1:n=i.sent();this.token=n.token;a.setItem(u,this.token);for(r in n)this.hasOwnProperty(r)&&(this[r]=n[r]);this.registerPingService();return[2,this]}}))}))};e.prototype.save=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:e.sent();return[2,this]}}))}))};e.prototype.getFriends=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))};e.prototype.getOnlineFriends=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))};e.prototype.getFriendRequests=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))};e.prototype.sendFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.acceptFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.declineFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.blockUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.unblockUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.request=function(e,t,n,o,a){void 0===n&&(n={});void 0===a&&(a={});return r(this,void 0,void 0,(function(){var r,u,c,f;return i(this,(function(i){switch(i.label){case 0:a["Accept"]="application/json";this.hasToken&&(a["Authorization"]="Bearer "+this.token);r=[];for(u in n)r.push(u+"="+n[u]);c=r.length>0?"?"+r.join("&"):"";f={headers:a};o&&(f.body=o);return[4,s[e](""+this.endpoint+t+c,f)];case 1:return[2,i.sent().data]}}))}))};e.prototype.logout=function(){this.token=void 0;a.removeItem(u);this.unregisterPingService()};e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3);this.unregisterPingService();this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)};e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)};return e}();t.Auth=f},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=n(13);Object.defineProperty(t,"Schema",{enumerable:1,get:function(){return r.Schema}});var i=n(11);Object.defineProperty(t,"MapSchema",{enumerable:1,get:function(){return i.MapSchema}});var o=n(10);Object.defineProperty(t,"ArraySchema",{enumerable:1,get:function(){return o.ArraySchema}});var s=n(95);Object.defineProperty(t,"dumpChanges",{enumerable:1,get:function(){return s.dumpChanges}});var a=n(96);Object.defineProperty(t,"Reflection",{enumerable:1,get:function(){return a.Reflection}});Object.defineProperty(t,"ReflectionType",{enumerable:1,get:function(){return a.ReflectionType}});Object.defineProperty(t,"ReflectionField",{enumerable:1,get:function(){return a.ReflectionField}});var u=n(48);Object.defineProperty(t,"type",{enumerable:1,get:function(){return u.type}});Object.defineProperty(t,"deprecated",{enumerable:1,get:function(){return u.deprecated}});Object.defineProperty(t,"filter",{enumerable:1,get:function(){return u.filter}});Object.defineProperty(t,"defineTypes",{enumerable:1,get:function(){return u.defineTypes}});Object.defineProperty(t,"Context",{enumerable:1,get:function(){return u.Context}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.ChangeTree=void 0;var r=n(13),i=n(10),o=n(11),s=function(){function e(e,t,n){void 0===e&&(e={});void 0===t&&(t=null);this.changed=0;this.changes=new Set;this.allChanges=new Set;this.deletedKeys={};this.fieldIndexes=e;this.parent=n;this.parentField=t}e.prototype.change=function(e,t){void 0===t&&(t=0);var n=this.fieldIndexes[e],r="number"==typeof n?n:e;if(t){if(t){this.changed=1;this.changes.add(r);this.allChanges.delete(r)}}else{this.changed=1;this.changes.add(r);this.allChanges.add(r)}this.parent&&this.parent.change(this.parentField)};e.prototype.mapIndex=function(e,t){if("object"==typeof e){if(!this.indexMap){this.indexMap=new Map;this.indexChange=new Map}this.indexMap.set(e,t)}};e.prototype.getIndex=function(e){return this.indexMap&&this.indexMap.get(e)};e.prototype.deleteIndex=function(e){if("object"==typeof e){this.deletedKeys[this.indexMap.get(e)]=1;this.indexMap.delete(e)}};e.prototype.isDeleted=function(e){return void 0!==this.deletedKeys[e]};e.prototype.mapIndexChange=function(e,t){"object"!=typeof e||this.indexChange.has(e)||this.indexChange.set(e,t)};e.prototype.getIndexChange=function(e){return this.indexChange&&this.indexChange.get(e)};e.prototype.deleteIndexChange=function(e){"object"==typeof e&&this.indexChange.delete(e)};e.prototype.changeAll=function(e){if(e instanceof r.Schema){var t=e["_schema"];for(var n in t){(e[n]instanceof r.Schema||e[n]instanceof i.ArraySchema||e[n]instanceof o.MapSchema)&&!e[n].$changes.parent.parent&&(e[n].$changes.parent=this);void 0!==e[n]&&this.change(n)}}else for(var s,a=0,u=Object.keys(e);a<u.length;a++){var c=u[a];void 0!==e[c]&&this.change(c)}};e.prototype.discard=function(){this.changed=0;this.changes.clear();this.deletedKeys={};this.indexChange&&this.indexChange.clear()};e.prototype.clone=function(){return new e(this.fieldIndexes,this.parentField,void 0)};return e}();t.ChangeTree=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.defineTypes=t.deprecated=t.filter=t.type=t.globalContext=t.Context=void 0;var r=n(47),i=n(13),o=function(){function e(){this.types={};this.schemas=new Map}e.prototype.has=function(e){return this.schemas.has(e)};e.prototype.get=function(e){return this.types[e]};e.prototype.add=function(e){e._typeid=this.schemas.size;this.types[e._typeid]=e;this.schemas.set(e,e._typeid)};return e}();t.Context=o;t.globalContext=new o;function s(e,n){void 0===n&&(n=t.globalContext);return function(t,o){var s=t.constructor;s._context=n;if(!n.has(s)){n.add(s);s._schema=Object.assign({},s._schema||{});s._indexes=Object.assign({},s._indexes||{});s._fieldsByIndex=Object.assign({},s._fieldsByIndex||{});s._descriptors=Object.assign({},s._descriptors||{});s._deprecated=Object.assign({},s._deprecated||{})}var a=Object.keys(s._schema).length;s._fieldsByIndex[a]=o;s._indexes[o]=a;s._schema[o]=e;if(!s._descriptors[o]){var u=Array.isArray(e),c=!u&&e.map,f="function"==typeof s._schema[o],h="_"+o;s._descriptors[h]={enumerable:0,configurable:0,writable:1};s._descriptors[o]={get:function(){return this[h]},set:function(e){(u||c)&&(e=new Proxy(e,{get:function(e,t){return e[t]},set:function(e,t,n){if("length"!==t&&0!==t.indexOf("$")){var o=u?Number(t):String(t);if(!e.$sorting){var s=e.$changes.getIndex(n);void 0!==s&&e.$changes.mapIndexChange(n,s);e.$changes.mapIndex(n,o)}if(n instanceof i.Schema){if(!n.$changes.parent){n.$changes=new r.ChangeTree(n._indexes,o,e.$changes);n.$changes.changeAll(n)}}else e[t]=n;e.$changes.change(o)}else n!==e[t];e[t]=n;return 1},deleteProperty:function(e,t){var n=e[t];if(c&&void 0!==n){e.$changes.deleteIndex(n);e.$changes.deleteIndexChange(n);n.$changes&&delete n.$changes.parent}delete e[t];var r=u?Number(t):String(t);e.$changes.change(r,1);return 1}}));if(e!==this[h]){this[h]=e;if(u){this.$changes.change(o);e.$changes=new r.ChangeTree({},o,this.$changes);for(var t=0;t<e.length;t++){if(e[t]instanceof i.Schema){e[t].$changes=new r.ChangeTree(e[t]._indexes,t,e.$changes);e[t].$changes.changeAll(e[t])}e.$changes.mapIndex(e[t],t);e.$changes.change(t)}}else if(c){e.$changes=new r.ChangeTree({},o,this.$changes);this.$changes.change(o);for(var n in e){if(e[n]instanceof i.Schema){e[n].$changes=new r.ChangeTree(e[n]._indexes,n,e.$changes);e[n].$changes.changeAll(e[n])}e.$changes.mapIndex(e[n],n);e.$changes.change(n)}}else if(f){this.$changes.change(o);if(e){e.$changes=new r.ChangeTree(e._indexes,o,this.$changes);e.$changes.changeAll(e)}}else this.$changes.change(o)}},enumerable:1,configurable:1}}}}t.type=s;function a(e){return function(t,n){var r=t.constructor;r._filters||(r._filters={});r._filters[n]=e}}t.filter=a;function u(e,n){void 0===e&&(e=1);void 0===n&&(n=t.globalContext);return function(t,n){var r=t.constructor;r._deprecated[n]=1;e&&(r._descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:0,configurable:1})}}t.deprecated=u;function c(e,n,r){void 0===r&&(r=t.globalContext);for(var i in n)s(n[i],r)(e.prototype,i);return e}t.defineTypes=c},function(n,r,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:1});const s=o(i(50)),a=o(i(99)),u={host_data:JSON.stringify(a.default)};let c;try{c=new s.default(mzAPI,u)}catch(n){c=new s.default({getUserData:e,getCurrentRealm:t},u)}engine.addSystem(c)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});const r=n(74),i=n(14);class o{constructor(){const e=new r.Client(""+i.WS_HOST),t=new Entity,n=new BoxShape;t.addComponent(n);t.addComponent(new Transform({position:new Vector3(0,1,8)}));engine.addEntity(t);const o=t.getComponent(Transform).position;e.joinOrCreate("example").then(e=>{e.onStateChange((e,...t)=>{console.log("state change",e,t);o.set(e.x,o.y,o.z)})})}update(e){}}t.default=o},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});n(75);var r=n(76);t.Client=r.Client;var i=n(41);t.Protocol=i.Protocol;t.ErrorCode=i.ErrorCode;var o=n(38);t.Room=o.Room;var s=n(45);t.Auth=s.Auth;t.Platform=s.Platform;var a=n(88);t.FossilDeltaSerializer=a.FossilDeltaSerializer;var u=n(93);t.SchemaSerializer=u.SchemaSerializer;var c=n(40);t.registerSerializer=c.registerSerializer;c.registerSerializer("fossil-delta",a.FossilDeltaSerializer);c.registerSerializer("schema",u.SchemaSerializer)},function(e,t){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer})},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=2&s[0]?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;(i=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];i=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}};Object.defineProperty(t,"__esModule",{value:1});var s=n(37),a=n(77),u=n(38),c=n(45),f=n(87),h=function(e){r(t,e);function t(n,r){var i=e.call(this,n)||this;i.code=r;Object.setPrototypeOf(i,t.prototype);return i}return t}(Error);t.MatchMakeError=h;var l=function(){function e(e){void 0===e&&(e=location.protocol.replace("http","ws")+"//"+location.hostname+(location.port&&":"+location.port));this.endpoint=e;this.auth=new c.Auth(this.endpoint);this.push=new f.Push(this.endpoint)}e.prototype.joinOrCreate=function(e,t,n){void 0===t&&(t={});return i(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,r.sent()]}}))}))};e.prototype.create=function(e,t,n){void 0===t&&(t={});return i(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,r.sent()]}}))}))};e.prototype.join=function(e,t,n){void 0===t&&(t={});return i(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,r.sent()]}}))}))};e.prototype.joinById=function(e,t,n){void 0===t&&(t={});return i(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,r.sent()]}}))}))};e.prototype.reconnect=function(e,t,n){return i(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,r.sent()]}}))}))};e.prototype.getAvailableRooms=function(e){void 0===e&&(e="");return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:t=this.endpoint.replace("ws","http")+"/matchmake/"+e;return[4,s.get(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}}))}))};e.prototype.consumeSeatReservation=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){(n=this.createRoom(e.room.name,t)).id=e.room.roomId;n.sessionId=e.sessionId;n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId}));return[2,new Promise((function(e,t){var r=function(e,n){return t(new a.ServerError(e,n))};n.onError.once(r);n.onJoin.once((function(){n.onError.remove(r);e(n)}))}))]}))}))};e.prototype.createMatchMakeRequest=function(e,t,n,r){void 0===n&&(n={});return i(this,void 0,void 0,(function(){var i,a;return o(this,(function(o){switch(o.label){case 0:i=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t;this.auth.hasToken&&(n.token=this.auth.token);return[4,s.post(i,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((a=o.sent().data).error)throw new h(a.error,a.code);return[2,this.consumeSeatReservation(a,r)]}}))}))};e.prototype.createRoom=function(e,t){return new u.Room(e,t)};e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(r+"="+t[r]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")};return e}();t.Client=l},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:1});var i=function(e){r(t,e);function t(t,n){var r=e.call(this,n)||this;r.name="ServerError";r.code=t;return r}return t}(Error);t.ServerError=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function r(e,t){this._offset=t;if(e instanceof ArrayBuffer){this._buffer=e;this._view=new DataView(this._buffer)}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer;this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function i(e,t,n){for(var r="",i=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((i=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536){i-=65536;r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))}else r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else r+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else r+=String.fromCharCode(a)}return r}r.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t};r.prototype._map=function(e){for(var t="",n={},r=0;r<e;r++)n[t=this._parse()]=this._parse();return n};r.prototype._str=function(e){var t=i(this._view,this._offset,e);this._offset+=e;return t};r.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);this._offset+=e;return t};r.prototype._parse=function(){var e=this._view.getUint8(this._offset++),t,n=0,r=0,i=0,o=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return 0;case 195:return 1;case 196:n=this._view.getUint8(this._offset);this._offset+=1;return this._bin(n);case 197:n=this._view.getUint16(this._offset);this._offset+=2;return this._bin(n);case 198:n=this._view.getUint32(this._offset);this._offset+=4;return this._bin(n);case 199:n=this._view.getUint8(this._offset);r=this._view.getInt8(this._offset+1);this._offset+=2;return[r,this._bin(n)];case 200:n=this._view.getUint16(this._offset);r=this._view.getInt8(this._offset+2);this._offset+=3;return[r,this._bin(n)];case 201:n=this._view.getUint32(this._offset);r=this._view.getInt8(this._offset+4);this._offset+=5;return[r,this._bin(n)];case 202:t=this._view.getFloat32(this._offset);this._offset+=4;return t;case 203:t=this._view.getFloat64(this._offset);this._offset+=8;return t;case 204:t=this._view.getUint8(this._offset);this._offset+=1;return t;case 205:t=this._view.getUint16(this._offset);this._offset+=2;return t;case 206:t=this._view.getUint32(this._offset);this._offset+=4;return t;case 207:i=this._view.getUint32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return i+o;case 208:t=this._view.getInt8(this._offset);this._offset+=1;return t;case 209:t=this._view.getInt16(this._offset);this._offset+=2;return t;case 210:t=this._view.getInt32(this._offset);this._offset+=4;return t;case 211:i=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return i+o;case 212:r=this._view.getInt8(this._offset);this._offset+=1;if(0===r){this._offset+=1;return}return[r,this._bin(1)];case 213:r=this._view.getInt8(this._offset);this._offset+=1;return[r,this._bin(2)];case 214:r=this._view.getInt8(this._offset);this._offset+=1;return[r,this._bin(4)];case 215:r=this._view.getInt8(this._offset);this._offset+=1;if(0===r){i=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return new Date(i+o)}return[r,this._bin(8)];case 216:r=this._view.getInt8(this._offset);this._offset+=1;return[r,this._bin(16)];case 217:n=this._view.getUint8(this._offset);this._offset+=1;return this._str(n);case 218:n=this._view.getUint16(this._offset);this._offset+=2;return this._str(n);case 219:n=this._view.getUint32(this._offset);this._offset+=4;return this._str(n);case 220:n=this._view.getUint16(this._offset);this._offset+=2;return this._array(n);case 221:n=this._view.getUint32(this._offset);this._offset+=4;return this._array(n);case 222:n=this._view.getUint16(this._offset);this._offset+=2;return this._map(n);case 223:n=this._view.getUint32(this._offset);this._offset+=4;return this._map(n)}throw new Error("Could not parse")};function o(e,t){void 0===t&&(t=0);var n=new r(e,t),i=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return i}t.default=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function r(e,t,n){for(var r=0,i=0,o=n.length;i<o;i++)if((r=n.charCodeAt(i))<128)e.setUint8(t++,r);else if(r<2048){e.setUint8(t++,192|r>>6);e.setUint8(t++,128|63&r)}else if(r<55296||r>=57344){e.setUint8(t++,224|r>>12);e.setUint8(t++,128|r>>6&63);e.setUint8(t++,128|63&r)}else{i++;r=65536+((1023&r)<<10|1023&n.charCodeAt(i));e.setUint8(t++,240|r>>18);e.setUint8(t++,128|r>>12&63);e.setUint8(t++,128|r>>6&63);e.setUint8(t++,128|63&r)}}function i(e){for(var t=0,n=0,r=0,i=e.length;r<i;r++)if((t=e.charCodeAt(r))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{r++;n+=4}return n}function o(e,t,n){var r=typeof n,s=0,a=0,u=0,c=0,f=0,h=0;if("string"===r){if((f=i(n))<32){e.push(160|f);h=1}else if(f<256){e.push(217,f);h=2}else if(f<65536){e.push(218,f>>8,f);h=3}else{if(!(f<4294967296))throw new Error("String too long");e.push(219,f>>24,f>>16,f>>8,f);h=5}t.push({_str:n,_length:f,_offset:e.length});return h+f}if("number"===r){if(Math.floor(n)!==n||!isFinite(n)){e.push(203);t.push({_float:n,_length:8,_offset:e.length});return 9}if(n>=0){if(n<128){e.push(n);return 1}if(n<256){e.push(204,n);return 2}if(n<65536){e.push(205,n>>8,n);return 3}if(n<4294967296){e.push(206,n>>24,n>>16,n>>8,n);return 5}u=n/Math.pow(2,32)>>0;c=n>>>0;e.push(207,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c);return 9}if(n>=-32){e.push(n);return 1}if(n>=-128){e.push(208,n);return 2}if(n>=-32768){e.push(209,n>>8,n);return 3}if(n>=-2147483648){e.push(210,n>>24,n>>16,n>>8,n);return 5}u=Math.floor(n/Math.pow(2,32));c=n>>>0;e.push(211,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c);return 9}if("object"===r){if(null===n){e.push(192);return 1}if(Array.isArray(n)){if((f=n.length)<16){e.push(144|f);h=1}else if(f<65536){e.push(220,f>>8,f);h=3}else{if(!(f<4294967296))throw new Error("Array too large");e.push(221,f>>24,f>>16,f>>8,f);h=5}for(s=0;s<f;s++)h+=o(e,t,n[s]);return h}if(n instanceof Date){var l=n.getTime();u=Math.floor(l/Math.pow(2,32));c=l>>>0;e.push(215,0,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c);return 10}if(n instanceof ArrayBuffer){if((f=n.byteLength)<256){e.push(196,f);h=2}else if(f<65536){e.push(197,f>>8,f);h=3}else{if(!(f<4294967296))throw new Error("Buffer too large");e.push(198,f>>24,f>>16,f>>8,f);h=5}t.push({_bin:n,_length:f,_offset:e.length});return h+f}if("function"==typeof n.toJSON)return o(e,t,n.toJSON());var p=[],d="",v=Object.keys(n);for(s=0,a=v.length;s<a;s++)"function"!=typeof n[d=v[s]]&&p.push(d);if((f=p.length)<16){e.push(128|f);h=1}else if(f<65536){e.push(222,f>>8,f);h=3}else{if(!(f<4294967296))throw new Error("Object too large");e.push(223,f>>24,f>>16,f>>8,f);h=5}for(s=0;s<f;s++){h+=o(e,t,d=p[s]);h+=o(e,t,n[d])}return h}if("boolean"===r){e.push(n?195:194);return 1}if("undefined"===r){e.push(212,0,0);return 3}throw new Error("Could not encode")}function s(e){var t=[],n=[],i=o(t,n,e),s=new ArrayBuffer(i),a=new DataView(s),u=0,c=0,f=-1;n.length>0&&(f=n[0]._offset);for(var h,l=0,p=0,d=0,v=t.length;d<v;d++){a.setUint8(c+d,t[d]);if(d+1===f){l=(h=n[u])._length;p=c+f;if(h._bin)for(var y=new Uint8Array(h._bin),g=0;g<l;g++)a.setUint8(p+g,y[g]);else h._str?r(a,p,h._str):void 0!==h._float&&a.setFloat64(p,h._float);c+=l;n[++u]&&(f=n[u]._offset)}}return s}t.default=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){void 0===t&&(t=0);this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))};e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}();t.EventEmitter=r;function i(){var e=new r;function t(t){return e.register(t,null===this)}t.once=function(t){var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];t.apply(void 0,r);e.remove(n)};e.register(n)};t.remove=function(t){return e.remove(t)};t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)};t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)};t.clear=function(){return e.clear()};return t}t.createSignal=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createNanoEvents=void 0;let r=()=>({events:{},emit(e,...t){for(let n of this.events[e]||[])n(...t)},on(e,t){(this.events[e]=this.events[e]||[]).push(t);return()=>this.events[e]=this.events[e].filter(e=>e!==t)}});t.createNanoEvents=r},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});var o=i(n(83)),s=function(e){r(t,e);function t(t,n){void 0===n&&(n=1);var r=e.call(this,t,void 0,{connect:n})||this;r._enqueuedCalls=[];return r}t.prototype.onOpenCallback=function(t){e.prototype.onOpenCallback.call(this);this.binaryType="arraybuffer";if(this._enqueuedCalls.length>0){for(var n=0,r=this._enqueuedCalls;n<r.length;n++){var i=r[n],o=i[0],s=i[1];this[o].apply(this,s)}this._enqueuedCalls=[]}};t.prototype.send=function(t){if(this.ws.readyState===o.default.OPEN){if(t instanceof ArrayBuffer)return e.prototype.send.call(this,t);if(Array.isArray(t))return e.prototype.send.call(this,new Uint8Array(t).buffer)}else this._enqueuedCalls.push(["send",[t]])};return t}(o.default);t.Connection=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||0;r.configurable=1;"value"in r&&(r.writable=1);Object.defineProperty(e,r.key,r)}}return function(t,n,r){n&&e(t.prototype,n);r&&e(t,r);return t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(84).createBackoff,s="undefined"!=typeof WebSocket?WebSocket:n(85),a=function(){function e(t,n,r){var s=arguments.length>2&&void 0!==r?arguments[2]:{};i(this,e);this.url=t;this.protocols=n;this.reconnectEnabled=1;this.listeners={};this.backoff=o(s.backoff||"exponential",s);this.backoff.onReady=this.onBackoffReady.bind(this);("undefined"==typeof s.connect||s.connect)&&this.open()}r(e,[{key:"open",value:function e(t){var n=arguments.length>0&&void 0!==t?arguments[0]:0;this.isReconnect=n;var r=this.ws&&this.ws.binaryType;this.ws=new s(this.url,this.protocols);this.ws.onclose=this.onCloseCallback.bind(this);this.ws.onerror=this.onErrorCallback.bind(this);this.ws.onmessage=this.onMessageCallback.bind(this);this.ws.onopen=this.onOpenCallback.bind(this);r&&(this.ws.binaryType=r)}},{key:"onBackoffReady",value:function e(t,n){this.open(1)}},{key:"onCloseCallback",value:function e(t){!this.isReconnect&&this.listeners["onclose"]&&this.listeners["onclose"].apply(null,arguments);this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function e(){this.listeners["onerror"]&&this.listeners["onerror"].apply(null,arguments)}},{key:"onMessageCallback",value:function e(){this.listeners["onmessage"]&&this.listeners["onmessage"].apply(null,arguments)}},{key:"onOpenCallback",value:function e(){this.listeners["onopen"]&&this.listeners["onopen"].apply(null,arguments);this.isReconnect&&this.listeners["onreconnect"]&&this.listeners["onreconnect"].apply(null,arguments);this.isReconnect=0}},{key:"close",value:function e(t,n){"undefined"==typeof t&&(t=1e3);this.reconnectEnabled=0;this.ws.close(t,n)}},{key:"send",value:function e(t){this.ws.send(t)}},{key:"bufferedAmount",get:function e(){return this.ws.bufferedAmount}},{key:"readyState",get:function e(){return this.ws.readyState}},{key:"binaryType",get:function e(){return this.ws.binaryType},set:function e(t){this.ws.binaryType=t}},{key:"extensions",get:function e(){return this.ws.extensions},set:function e(t){this.ws.extensions=t}},{key:"protocol",get:function e(){return this.ws.protocol},set:function e(t){this.ws.protocol=t}},{key:"onclose",set:function e(t){this.listeners["onclose"]=t},get:function e(){return this.listeners["onclose"]}},{key:"onerror",set:function e(t){this.listeners["onerror"]=t},get:function e(){return this.listeners["onerror"]}},{key:"onmessage",set:function e(t){this.listeners["onmessage"]=t},get:function e(){return this.listeners["onmessage"]}},{key:"onopen",set:function e(t){this.listeners["onopen"]=t},get:function e(){return this.listeners["onopen"]}},{key:"onreconnect",set:function e(t){this.listeners["onreconnect"]=t},get:function e(){return this.listeners["onreconnect"]}}]);return e}();a.CONNECTING=s.CONNECTING;a.OPEN=s.OPEN;a.CLOSING=s.CLOSING;a.CLOSED=s.CLOSED;t.default=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createBackoff=i;var r={exponential:function e(t,n){return Math.floor(Math.random()*Math.pow(2,t)*n)},fibonacci:function e(t,n){var r;if(t>(r=1))for(var i=1,r=2,o=2;o<t;o++){var s=i+r;i=r;r=s}return Math.floor(Math.random()*r*n)}};function i(e,t){return new o(r[e],t)}function o(e,t){this.func=e;this.attempts=0;this.delay="undefined"!=typeof t.initialDelay?t.initialDelay:100}o.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(e,t){},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r;function i(){r||(r="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}});return r}function o(e,t){i().setItem(e,t)}t.setItem=o;function s(e){i().removeItem(e)}t.removeItem=s;function a(e,t){var n=i().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((function(e){return t(e)})):t(n)}t.getItem=a},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=2&s[0]?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;(i=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];i=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}};Object.defineProperty(t,"__esModule",{value:1});var o=function(){function e(e){this.endpoint=e.replace("ws","http")}e.prototype.register=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:this.check();return[4,this.registerServiceWorker()];case 1:e.sent();return[4,this.requestNotificationPermission()];case 2:e.sent();return[2]}}))}))};e.prototype.registerServiceWorker=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,navigator.serviceWorker.register(this.endpoint+"/push")];case 1:return[2,e.sent()]}}))}))};e.prototype.requestNotificationPermission=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,window["Notification"].requestPermission()];case 1:if("granted"!==(e=t.sent()))throw new Error("Permission not granted for Notification");return[2]}}))}))};e.prototype.check=function(){if(!("serviceWorker"in navigator))throw new Error("No Service Worker support!");if(!("PushManager"in window))throw new Error("No Push API Support!")};return e}();t.Push=o},function(e,t,n){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:1});var i=n(89),o=r(n(92)),s=r(n(39)),a=function(){function e(){this.api=new i.StateContainer({})}e.prototype.getState=function(){return this.api.state};e.prototype.setState=function(e){this.previousState=new Uint8Array(e);this.api.set(s.decode(this.previousState))};e.prototype.patch=function(e){this.previousState=new Uint8Array(o.apply(this.previousState,e));this.api.set(s.decode(this.previousState))};e.prototype.teardown=function(){this.api.removeAllListeners()};return e}();t.FossilDeltaSerializer=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=n(90);t.StateContainer=r.StateContainer},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=n(91),i=function(){function e(e){this.listeners=[];this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/};this.state=e;this.reset()}e.prototype.set=function(e){var t=r.compare(this.state,e);this.state=e;this.checkPatches(t,this.listeners,this.defaultListener);return t};e.prototype.registerPlaceholder=function(e,t){this.matcherPlaceholders[e]=t};e.prototype.listen=function(e,t,n){var i=this,o;if("function"==typeof e){o=[];t=e}else o=e.split("/");t.length>1&&console.warn(".listen() accepts only one parameter.");var s={callback:t,rawRules:o,rules:o.map((function(e){return"string"==typeof e?0===e.indexOf(":")?i.matcherPlaceholders[e]||i.matcherPlaceholders[":*"]:new RegExp("^"+e+"$"):e}))};0===o.length?this.defaultListener=s:this.listeners.push(s);n&&this.checkPatches(r.compare({},this.state),[s]);return s};e.prototype.removeListener=function(e){for(var t=this.listeners.length-1;t>=0;t--)this.listeners[t]===e&&this.listeners.splice(t,1)};e.prototype.removeAllListeners=function(){this.reset()};e.prototype.checkPatches=function(e,t,n){for(var r=0,i=t.length;r<i;r++)for(var o=t[r],s=e.length-1;s>=0;s--){var a=o&&this.getPathVariables(e[s],o);if(a){o.callback({path:a,rawPath:e[s].path,operation:e[s].operation,value:e[s].value});e[s].matched=1}}if(n)for(var s=e.length-1;s>=0;s--)e[s].matched||n.callback(e[s])};e.prototype.getPathVariables=function(e,t){if(e.path.length!==t.rules.length)return 0;for(var n={},r=0,i=t.rules.length;r<i;r++){var o=e.path[r].match(t.rules[r]);if(!o||0===o.length||o.length>2)return 0;":"===t.rawRules[r].substr(0,1)&&(n[t.rawRules[r].substr(1)]=o[1])}return n};e.prototype.reset=function(){this.listeners=[]};return e}();t.StateContainer=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function r(e,t){var n=[];s(e,t,n,[]);return n}t.compare=r;function i(e,t){var n=e.slice();n.push(t);return n}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(i);return r}function s(e,t,n,r){for(var a=o(t),u=o(e),c=0,f=u.length-1;f>=0;f--){var h,l=e[h=u[f]];if(!t.hasOwnProperty(h)||void 0===t[h]&&void 0!==l&&0==Array.isArray(t)){n.push({operation:"remove",path:i(r,h)});c=1}else{var p=t[h];"object"==typeof l&&null!=l&&"object"==typeof p&&null!=p?s(l,p,n,i(r,h)):l!==p&&n.push({operation:"replace",path:i(r,h),value:p,previousValue:l})}}if(c||a.length!=u.length)for(var f=a.length-1;f>=0;f--){var h=a[f];if(!e.hasOwnProperty(h)&&void 0!==t[h]){var p=t[h],d=i(r,h);"object"==typeof p&&null!=p&&s({},p,n,d);n.push({operation:"add",path:d,value:p})}}}},function(e,t,n){(function(t,n){1,e.exports?e.exports=n():t.fossilDelta=n()})(this,(function(){var e={},t=16;function n(){this.a=0;this.b=0;this.i=0;this.z=new Array(t)}n.prototype.init=function(e,n){var r=0,i=0,o,s;for(o=0;o<t;o++){r=r+(s=e[n+o])&65535;i=i+(t-o)*s&65535;this.z[o]=s}this.a=65535&r;this.b=65535&i;this.i=0};n.prototype.next=function(e){var n=this.z[this.i];this.z[this.i]=e;this.i=this.i+1&t-1;this.a=this.a-n+e&65535;this.b=this.b-t*n+this.a&65535};n.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map((function(e){return e.charCodeAt(0)})),i=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];function o(e){this.a=e;this.pos=0}o.prototype.haveBytes=function(){return this.pos<this.a.length};o.prototype.getByte=function(){var e=this.a[this.pos];this.pos++;if(this.pos>this.a.length)throw new RangeError("out of bounds");return e};o.prototype.getChar=function(){return String.fromCharCode(this.getByte())};o.prototype.getInt=function(){for(var e=0,t;this.haveBytes()&&(t=i[127&this.getByte()])>=0;)e=(e<<6)+t;this.pos--;return e>>>0};function s(){this.a=[]}s.prototype.toArray=function(){return this.a};s.prototype.putByte=function(e){this.a.push(255&e)};s.prototype.putChar=function(e){this.putByte(e.charCodeAt(0))};s.prototype.putInt=function(e){var t,n,i=[];if(0!==e){for(t=0;e>0;t++,e>>>=6)i.push(r[63&e]);for(n=t-1;n>=0;n--)this.putByte(i[n])}else this.putChar("0")};s.prototype.putArray=function(e,t,n){for(var r=t;r<n;r++)this.a.push(e[r])};function a(e){var t,n;for(t=1,n=64;e>=n;t++,n<<=6);return t}function u(e){for(var t=0,n=0,r=0,i=0,o=0,s=e.length;s>=16;){t=t+e[o+0]|0;n=n+e[o+1]|0;r=r+e[o+2]|0;i=i+e[o+3]|0;t=t+e[o+4]|0;n=n+e[o+5]|0;r=r+e[o+6]|0;i=i+e[o+7]|0;t=t+e[o+8]|0;n=n+e[o+9]|0;r=r+e[o+10]|0;i=i+e[o+11]|0;t=t+e[o+12]|0;n=n+e[o+13]|0;r=r+e[o+14]|0;i=i+e[o+15]|0;o+=16;s-=16}for(;s>=4;){t=t+e[o+0]|0;n=n+e[o+1]|0;r=r+e[o+2]|0;i=i+e[o+3]|0;o+=4;s-=4}i=((i+(r<<8)|0)+(n<<16)|0)+(t<<24)|0;switch(s){case 3:i=i+(e[o+2]<<8)|0;case 2:i=i+(e[o+1]<<16)|0;case 1:i=i+(e[o+0]<<24)|0}return i>>>0}e.create=function(e,r){var i=new s,o=r.length,c=e.length,f,h=-1;i.putInt(o);i.putChar("\n");if(c<=t){i.putInt(o);i.putChar(":");i.putArray(r,0,o);i.putInt(u(r));i.putChar(";");return i.toArray()}var l=Math.ceil(c/t),p=new Array(l),d=new Array(l);for(f=0;f<p.length;f++)p[f]=-1;for(f=0;f<d.length;f++)d[f]=-1;var v,y=new n;for(f=0;f<c-t;f+=t){y.init(e,f);v=y.value()%l;p[f/t]=d[v];d[v]=f/t}for(var g=0,_,b,m,w,O;g+t<o;){w=0;O=0;y.init(r,g);f=0;m=0;for(;;){var A=250;b=d[v=y.value()%l];for(;b>=0&&A-- >0;){var C,S,E,I,M,P,k,x;for(I=0,P=_=b*t,k=g+f;P<c&&k<o&&e[P]===r[k];I++,P++,k++);I--;for(M=1;M<_&&M<=f&&e[_-M]===r[g+f-M];M++);S=_- --M;E=f-M;if((C=I+M+1)>=(x=a(f-M)+a(C)+a(S)+3)&&C>m){m=C;w=_-M;O=E}b=p[b]}if(m>0){if(O>0){i.putInt(O);i.putChar(":");i.putArray(r,g,g+O);g+=O}g+=m;i.putInt(m);i.putChar("@");i.putInt(w);i.putChar(",");w+m-1>h&&(h=w+m-1);m=0;break}if(g+f+t>=o){i.putInt(o-g);i.putChar(":");i.putArray(r,g,g+o-g);g=o;break}y.next(r[g+f+t]);f++}}if(g<o){i.putInt(o-g);i.putChar(":");i.putArray(r,g,g+o-g)}i.putInt(u(r));i.putChar(";");return i.toArray()};e.outputSize=function(e){var t=new o(e),n=t.getInt();if("\n"!==t.getChar())throw new Error("size integer not terminated by '\\n'");return n};e.apply=function(e,t,n){var r,i=0,a=new o(t),c=e.length,f=t.length;r=a.getInt();if("\n"!==a.getChar())throw new Error("size integer not terminated by '\\n'");for(var h=new s;a.haveBytes();){var l,p;l=a.getInt();switch(a.getChar()){case"@":p=a.getInt();if(a.haveBytes()&&","!==a.getChar())throw new Error("copy command not terminated by ','");if((i+=l)>r)throw new Error("copy exceeds output file size");if(p+l>c)throw new Error("copy extends past end of input");h.putArray(e,p,p+l);break;case":":if((i+=l)>r)throw new Error("insert command gives an output larger than predicted");if(l>f)throw new Error("insert count exceeds size of delta");h.putArray(a.a,a.pos,a.pos+l);a.pos+=l;break;case";":var d=h.toArray();if((!n||0!=n.verifyChecksum)&&l!==u(d))throw new Error("bad checksum");if(i!==r)throw new Error("generated size does not match predicted size");return d;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")};return e}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var r=n(46),i=function(){function e(){}e.prototype.setState=function(e){this.state.decode(e)};e.prototype.getState=function(){return this.state};e.prototype.patch=function(e){this.state.decode(e)};e.prototype.teardown=function(){};e.prototype.handshake=function(e,t){if(this.state){var n;(new r.Reflection).decode(e,t)}else this.state=r.Reflection.decode(e)};return e}();t.SchemaSerializer=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.EventEmitter=void 0;var r=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){void 0===t&&(t=0);this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))};e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}();t.EventEmitter=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.dumpChanges=void 0;var r=n(46),i=n(11),o=n(10);function s(e){for(var t={},n=e.$changes,a=e["_fieldsByIndex"]||{},u=0,c=Array.from(n.changes);u<c.length;u++){var f=c[u],h=a[f]||f;e[h]instanceof i.MapSchema||e[h]instanceof o.ArraySchema||e[h]instanceof r.Schema?t[h]=s(e[h]):t[h]=e[h]}return t}t.dumpChanges=s},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.Reflection=t.ReflectionType=t.ReflectionField=void 0;var o=n(48),s=n(13),a=n(10),u=n(11),c=new o.Context,f=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}i([o.type("string",c)],t.prototype,"name",void 0);i([o.type("string",c)],t.prototype,"type",void 0);i([o.type("uint8",c)],t.prototype,"referencedType",void 0);return t}(s.Schema);t.ReflectionField=f;var h=function(e){r(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.fields=new a.ArraySchema;return t}i([o.type("uint8",c)],t.prototype,"id",void 0);i([o.type([f],c)],t.prototype,"fields",void 0);return t}(s.Schema);t.ReflectionType=h;var l=function(e){r(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.types=new a.ArraySchema;return t}t.encode=function(e){var n=e.constructor,r=new t;r.rootType=n._typeid;var i=function(e,t){for(var n in t){var i=new f;i.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var s="function"==typeof t[n],a=Array.isArray(t[n]),u=!a&&t[n].map,c=void 0;if(s){o="ref";c=t[n]}else if(a){o="array";"string"==typeof t[n][0]?o+=":"+t[n][0]:c=t[n][0]}else if(u){o="map";"string"==typeof t[n].map?o+=":"+t[n].map:c=t[n].map}i.referencedType=c?c._typeid:255}i.type=o;e.fields.push(i)}r.types.push(e)},o=n._context.types;for(var s in o){var a=new h;a.id=Number(s);i(a,o[s]._schema)}return r.encodeAll()};t.decode=function(e){var n=new o.Context,i=new t;i.decode(e);var c=i.types.reduce((function(e,t){e[t.id]=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(s.Schema);return e}),{});i.types.forEach((function(e,t){e.fields.forEach((function(t){var r=c[e.id];if(void 0!==t.referencedType){var i=c[t.referencedType];i||(i=t.type.split(":")[1]);0===t.type.indexOf("array")?o.type([i],n)(r.prototype,t.name):0===t.type.indexOf("map")?o.type({map:i},n)(r.prototype,t.name):"ref"===t.type&&o.type(i,n)(r.prototype,t.name)}else o.type(t.type,n)(r.prototype,t.name)}))}));var f=c[i.rootType],h=new f;for(var l in f._schema){var p=f._schema[l];if("string"!=typeof p){var d="function"==typeof p,v=Array.isArray(p),y=!v&&p.map;h[l]=v?new a.ArraySchema:y?new u.MapSchema:d?new p:void 0}}return h};i([o.type([h],c)],t.prototype,"types",void 0);i([o.type("uint8",c)],t.prototype,"rootType",void 0);return t}(s.Schema);t.Reflection=l},,,function(e){e.exports=JSON.parse('{"sammichgame":{"position":{"x":8,"y":0.8,"z":14},"rotation":{"x":0,"y":0,"z":0},"scale":{"x":1.5,"y":1.5,"z":1},"hideFrame":true,"hideBoard":false,"hideAd":true,"gameID":"0,0","showScenario":true,"showJoinVoice":true,"soundDistance":100,"voiceChannel":"dcl-sammich-game"}}')}]);